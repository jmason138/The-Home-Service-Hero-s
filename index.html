<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOME SERVICE HERO: SCALE EDITION</title>
    <style>
        :root { --gold: #ffcc00; --cyan: #00f2ff; --red: #ff3333; }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Arial Black', sans-serif; overflow: hidden; }
        #game-viewport { position: relative; width: 800px; height: 600px; border: 4px solid #333; background: #111; overflow: hidden; }
        #menu, #win-screen, #lose-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; padding: 40px; }
        #win-screen, #lose-screen { display: none; }
        h1 { font-size: 3rem; margin: 0; color: var(--gold); }
        .message { font-size: 1.1rem; line-height: 1.4; margin: 20px 0; color: #ddd; max-width: 600px; }
        button { padding: 15px 30px; font-size: 1.1rem; font-weight: 900; cursor: pointer; border: 3px solid var(--gold); background: transparent; color: var(--gold); text-transform: uppercase; margin: 10px; transition: 0.2s; }
        button:hover { background: var(--gold); color: #000; }
        .hud { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-around; font-size: 1.2rem; pointer-events: none; z-index: 10; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="menu">
        <h1>HOME SERVICE HERO</h1>
        <p class="message">JUMP over the oversized Vans. DUCK under the Scam Ads.<br>[SPACE] to Double Jump | [S] or [DOWN] to Duck</p>
        <button onclick="initGame('hvac')">HVAC TECH</button>
        <button onclick="initGame('roofer')">ROOFER</button>
    </div>

    <div id="win-screen"><h1>INSTALL COMPLETE!</h1><button onclick="location.reload()">NEXT CUSTOMER</button></div>
    <div id="lose-screen"><h1 style="color:var(--red)">BID LOST!</h1><p class="message">The customer chose the low-bid competitor. Quality service denied.</p><button onclick="location.reload()">RE-BID</button></div>

    <div class="hud" id="hud" style="display:none;">
        <div>CHALLENGES: <span id="count">0</span> / 20</div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let state = { active: false, job: 'hvac', challenges: 0, speed: 8.5, houseX: 1600 };

    const assets = {};
    const sources = {
        bg: 'game_bg.jpg',
        hvac: 'hvac_normal.png',
        roofer: 'roofer_normal.png',
        van: 'van.png',
        scam: 'scam_ad.png',
        house: 'menu_bg.jpg'
    };

    Object.keys(sources).forEach(key => { assets[key] = new Image(); assets[key].src = sources[key]; });

    const player = { x: 50, y: 435, w: 100, h: 100, dy: 0, jump: 18, grav: 0.8, grounded: false, jumpsLeft: 2, isDucking: false };
    let obstacles = [];

    function initGame(job) {
        state.job = job; state.active = true;
        document.getElementById('menu').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        spawnLoop(); gameLoop();
    }

    function spawnLoop() {
        if (!state.active || state.challenges >= 20) return;
        
        const isHigh = Math.random() > 0.5;
        if(isHigh) {
            // SCAM AD (Duck)
            obstacles.push({ x: 850, y: 340, w: 200, h: 120, type: 'scam' });
        } else {
            // THE BIG VAN (Jump) - Scaled up to 220x140
            obstacles.push({ x: 850, y: 395, w: 220, h: 140, type: 'van' });
        }

        state.challenges++;
        document.getElementById('count').innerText = state.challenges;
        setTimeout(spawnLoop, 1600 + Math.random() * 900);
    }

    function gameLoop() {
        if (!state.active) return;
        update(); draw();
        requestAnimationFrame(gameLoop);
    }

    function update() {
        player.dy += player.grav;
        player.y += player.dy;

        if (player.y > 435) { 
            player.y = 435; player.dy = 0; player.grounded = true; player.jumpsLeft = 2; 
        }

        obstacles.forEach((obs, i) => {
            obs.x -= state.speed;
            if (checkCollision(player, obs)) {
                state.active = false;
                document.getElementById('lose-screen').style.display = 'flex';
            }
            if (obs.x < -300) obstacles.splice(i, 1);
        });

        if (state.challenges >= 20) {
            state.houseX -= state.speed;
            if (player.x + player.w > state.houseX + 50) {
                state.active = false;
                document.getElementById('win-screen').style.display = 'flex';
            }
        }
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 600);
        if(assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, 800, 600);
        if (state.challenges >= 20 && assets.house.complete) ctx.drawImage(assets.house, state.houseX, 200, 350, 350);

        const pImg = state.job === 'hvac' ? assets.hvac : assets.roofer;
        let dH = player.h;
        let dY = player.y;

        if(player.isDucking && player.grounded) {
            dH = player.h * 0.4; 
            dY = player.y + (player.h * 0.6);
        }

        if(pImg.complete) ctx.drawImage(pImg, player.x, dY, player.w, dH);

        obstacles.forEach(o => {
            if(assets[o.type].complete) {
                ctx.drawImage(assets[o.type], o.x, o.y, o.w, o.h);
            }
        });
    }

    function checkCollision(p, o) {
        let pH = p.isDucking && p.grounded ? p.h * 0.4 : p.h;
        let pY = p.isDucking && p.grounded ? p.y + (p.h * 0.6) : p.y;
        const b = 25; 
        return p.x + b < o.x + o.w && p.x + p.w - b > o.x && 
               pY + b < o.y + o.h && pY + pH - b > o.y;
    }

    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && player.jumpsLeft > 0) {
            player.dy = -player.jump; player.jumpsLeft--; player.grounded = false;
            player.isDucking = false;
        }
        if (e.code === 'KeyS' || e.code === 'ArrowDown') {
            player.isDucking = true;
        }
    });

    window.addEventListener('keyup', (e) => {
        if (e.code === 'KeyS' || e.code === 'ArrowDown') {
            player.isDucking = false;
        }
    });
</script>
</body>
</html>
