<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOME SERVICE HERO: PRO EDITION</title>
    <style>
        :root { --gold: #ffcc00; --blue: #00aaff; --red: #e31b23; }
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; touch-action: none; }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        
        #game-viewport { 
            position: relative; aspect-ratio: 16 / 9; width: 100vw; max-height: 100vh;
            background: #000; overflow: hidden; border: 4px solid #333;
        }

        canvas { width: 100%; height: 100%; display: block; }
        
        /* Branded Menu */
        #menu { position: absolute; inset: 0; z-index: 100; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 5%; }
        #menu-bg-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; z-index: -1; }
        
        .start-btn { 
            padding: 12px 30px; font-size: 1.1rem; font-weight: 900; border: 3px solid var(--gold); 
            background: rgba(0,0,0,0.85); color: var(--gold); margin: 8px; border-radius: 50px; cursor: pointer; 
        }

        /* The 5-Star Review Screen */
        #win-screen { 
            position: absolute; inset: 0; background: rgba(255,255,255,0.98); 
            display: none; flex-direction: column; justify-content: center; 
            align-items: center; z-index: 101; color: #333; text-align: center; padding: 5%;
        }
        .review-stars { width: 220px; margin: 15px 0; }
        .win-logo { max-width: 280px; max-height: 120px; margin-bottom: 20px; object-fit: contain; }
        .customer-text { font-family: 'Georgia', serif; font-style: italic; font-size: 1.3rem; line-height: 1.5; color: #444; margin-bottom: 25px; border-left: 5px solid var(--gold); padding-left: 15px; }

        #lose-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 101; color: #ff3333; }
        .tap-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 90; display: none; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="menu">
        <img id="menu-bg-img" src="menu_bg.jpg" alt="Title">
        <div style="display:flex;">
            <button class="start-btn" onclick="initGame('hvac')">A QUALITY HVAC</button>
            <button class="start-btn" onclick="initGame('roofer')">LYONS ROOFING</button>
        </div>
    </div>

    <div id="win-screen">
        <img id="win-brand-logo" class="win-logo" src="">
        <h2 id="win-status">SERVICE SUCCESS!</h2>
        <div id="customer-quote" class="customer-text"></div>
        <img src="google-stars.png" class="review-stars" alt="5 Stars">
        <p style="font-weight:bold; color:#555;">Review posted to Google Maps!</p>
        <button class="start-btn" style="background:#333; border-color:#333; color:white;" onclick="location.reload()">NEXT APPOINTMENT</button>
    </div>

    <div id="lose-screen"><h1>BID REJECTED</h1><button class="start-btn" onclick="location.reload()">TRY AGAIN</button></div>

    <div id="left-tap" class="tap-zone" style="left:0;"></div>
    <div id="right-tap" class="tap-zone" style="right:0;"></div>

    <canvas id="gameCanvas" width="800" height="450"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const GROUND_Y = 380; 

    let state = { active: false, job: 'hvac', challenges: 0, speed: 7.5, houseX: 1200 };
    const assets = {};
    const sources = {
        bg: 'game_bg.jpg', hvac_normal: 'hvac_normal.png', roofer_normal: 'roofer_normal.png',
        van: 'van.png', cone: 'obstacle_cone.png', crack: 'obstacle_crack.png',
        barricade: 'obstacle_barricade.png', lowbid: 'obstacle_lowbid.png',
        scam: 'scam_ad.png', house: 'menu_bg.jpg',
        logo_hvac: 'aQuality-logo.png', logo_roof: 'lyons-horz-logo.png',
        stars: 'google-stars.png'
    };

    Object.keys(sources).forEach(key => { assets[key] = new Image(); assets[key].src = sources[key]; });

    const player = { x: 80, y: GROUND_Y - 85, w: 85, h: 85, dy: 0, jump: 17, grav: 0.8, jumpsLeft: 2, isDucking: false };
    let obstacles = [];

    function initGame(job) {
        state.job = job; state.active = true;
        document.getElementById('menu').style.display = 'none';
        document.querySelectorAll('.tap-zone').forEach(z => z.style.display = 'block');
        spawnLoop(); gameLoop();
    }

    function spawnLoop() {
        if (!state.active || state.challenges >= 20) return;
        const types = ['van', 'cone', 'crack', 'barricade', 'lowbid', 'scam'];
        const type = types[Math.floor(Math.random() * types.length)];
        let w = 70, h = 70, y = GROUND_Y - 70;
        if(type === 'van') { w = 230; h = 135; y = GROUND_Y - 135; }
        if(type === 'scam') { w = 200; h = 85; y = GROUND_Y - 115; }
        obstacles.push({ x: 850, y: y, w: w, h: h, type: type });
        state.challenges++;
        setTimeout(spawnLoop, 1400 + Math.random() * 800);
    }

    function gameLoop() {
        if (!state.active) return;
        update(); draw();
        requestAnimationFrame(gameLoop);
    }

    function update() {
        player.dy += player.grav;
        player.y += player.dy;
        let floor = player.isDucking ? GROUND_Y - 40 : GROUND_Y - 85;
        if (player.y > floor) { player.y = floor; player.dy = 0; player.jumpsLeft = 2; }

        obstacles.forEach((obs) => {
            obs.x -= state.speed;
            if (checkCollision(player, obs)) {
                state.active = false; document.getElementById('lose-screen').style.display = 'flex';
            }
        });

        if (state.challenges >= 20) {
            state.houseX -= state.speed;
            if (player.x + player.w > state.houseX + 150) finishJob();
        }
    }

    function finishJob() {
        state.active = false;
        const winScreen = document.getElementById('win-screen');
        const logo = document.getElementById('win-brand-logo');
        const quote = document.getElementById('customer-quote');
        const status = document.getElementById('win-status');

        if(state.job === 'hvac') {
            logo.src = 'aQuality-logo.png';
            status.innerText = "A QUALITY REPAIR COMPLETE!";
            quote.innerHTML = "“My AC went out in 110-degree weather! <strong>A Quality HVAC</strong> arrived within the hour and had us cool again. Professional and honest—posting a 5-star review now!”";
        } else {
            logo.src = 'lyons-horz-logo.png';
            status.innerText = "LYONS ROOFING INSTALL COMPLETE!";
            quote.innerHTML = "“After the storm, we were worried about leaks. <strong>Lyons Roofing</strong> was incredible! Best crew in the business. They deserve every bit of this 5-star review!”";
        }
        winScreen.style.display = 'flex';
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 450);
        if(assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, 800, 450);
        
        // Branded HUD Logo
        const hudLogo = state.job === 'hvac' ? assets.logo_hvac : assets.logo_roof;
        if(hudLogo?.complete) ctx.drawImage(hudLogo, 620, 20, 150, 70);

        if (state.challenges >= 20 && assets.house.complete) ctx.drawImage(assets.house, state.houseX, 50, 400, 400);

        let charKey = `${state.job}_normal`;
        let drawH = player.isDucking ? 40 : 85;
        if(assets[charKey]?.complete) ctx.drawImage(assets[charKey], player.x, player.y, player.w, drawH);
        obstacles.forEach(o => { if(assets[o.type]?.complete) ctx.drawImage(assets[o.type], o.x, o.y, o.w, o.h); });
    }

    function checkCollision(p, o) {
        let pH = p.isDucking ? 40 : 85;
        return p.x + 25 < o.x + o.w && p.x + p.w - 25 > o.x && p.y + 20 < o.y + o.h && p.y + pH - 20 > o.y;
    }

    // Input
    window.addEventListener('keydown', (e) => {
        if ((e.code === 'Space' || e.code === 'ArrowUp') && player.jumpsLeft > 0) { player.dy = -player.jump; player.jumpsLeft--; }
        if (e.code === 'ArrowDown') player.isDucking = true;
    });
    window.addEventListener('keyup', (e) => { if (e.code === 'ArrowDown') player.isDucking = false; });
    
    document.getElementById('left-tap').addEventListener('touchstart', (e) => { e.preventDefault(); if (player.jumpsLeft > 0) { player.dy = -player.jump; player.jumpsLeft--; } });
    document.getElementById('right-tap').addEventListener('touchstart', (e) => { e.preventDefault(); player.isDucking = true; });
    document.getElementById('right-tap').addEventListener('touchend', (e) => { e.preventDefault(); player.isDucking = false; });
</script>
</body>
</html>
