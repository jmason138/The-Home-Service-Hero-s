<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOME SERVICE HERO</title>
    <style>
        :root { --gold: #ffcc00; }
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; touch-action: none; }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        
        #game-viewport { 
            position: relative; aspect-ratio: 16 / 9; width: 100vw; max-height: 100vh;
            background: #000; overflow: hidden; border: 2px solid #444;
        }

        canvas { width: 100%; height: 100%; display: block; }
        
        /* Menu Overhaul */
        #menu { 
            position: absolute; inset: 0; z-index: 100; 
            display: flex; flex-direction: column; justify-content: space-between; 
            align-items: center; padding: 20px;
        }
        #menu-bg-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; z-index: -1; }

        .menu-top-logos { 
            display: flex; gap: 30px; align-items: center; 
            background: rgba(255,255,255,0.95); padding: 10px 30px; 
            border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .header-logo { height: 45px; object-fit: contain; }

        .instruction-box { 
            background: rgba(0,0,0,0.85); border: 2px solid var(--gold); border-radius: 15px;
            padding: 15px; color: white; text-align: center; max-width: 500px;
        }
        .instruction-box h3 { color: var(--gold); margin: 0 0 5px 0; font-size: 0.9rem; text-transform: uppercase; }
        .instruction-box p { margin: 3px 0; font-size: 0.8rem; font-family: sans-serif; }

        /* Branded Image Buttons */
        .select-header { color: white; text-shadow: 2px 2px #000; margin-bottom: 5px; font-size: 1.2rem; }
        .btn-container { display: flex; gap: 20px; padding-bottom: 30px; }
        
        .img-btn { 
            background: white; border: 4px solid var(--gold); border-radius: 15px;
            padding: 10px; cursor: pointer; transition: transform 0.1s, box-shadow 0.1s;
            width: 180px; height: 100px; display: flex; align-items: center; justify-content: center;
        }
        .img-btn:active { transform: scale(0.95); }
        .img-btn:hover { box-shadow: 0 0 20px var(--gold); }
        .img-btn img { max-width: 100%; max-height: 100%; object-fit: contain; }

        /* Win/Lose Screens */
        #win-screen { position: absolute; inset: 0; background: white; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 101; color: #333; text-align: center; padding: 5%; }
        #lose-screen { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 101; color: #ff3333; }
        .tap-zone { position: absolute; top: 0; height: 100%; width: 50%; z-index: 90; display: none; }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="menu">
        <img id="menu-bg-img" src="menu_bg.jpg.jpg" alt="Title">
        
        <div class="menu-top-logos">
            <img src="aQuality-logo.png" class="header-logo">
            <img src="lyons-horz-logo.png" class="header-logo">
        </div>

        <div class="instruction-box">
            <h3>Objective: Deliver Heroic Service!</h3>
            <p><strong>COMPUTER:</strong> [Space] Jump | [Down Arrow] Duck</p>
            <p><strong>MOBILE:</strong> Tap Left to Jump | Hold Right to Duck</p>
        </div>

        <div style="text-align:center;">
            <div class="select-header">SELECT YOUR HOME SERVICE PRO</div>
            <div class="btn-container">
                <button class="img-btn" onclick="initGame('hvac')">
                    <img src="aQuality-logo.png" alt="A Quality HVAC">
                </button>
                <button class="img-btn" onclick="initGame('roofer')">
                    <img src="lyons-horz-logo.png" alt="Lyons Roofing">
                </button>
            </div>
        </div>
    </div>

    <div id="win-screen">
        <img id="win-brand-logo" style="max-width:220px; margin-bottom:15px;">
        <h2>SERVICE SUCCESS!</h2>
        <div id="customer-quote" style="font-family:serif; font-style:italic; font-size:1.1rem; margin: 15px; color:#444;"></div>
        <img src="google-stars.png" style="width:180px; margin-bottom:10px;">
        <button class="img-btn" style="height:60px; width:150px; background:#333; border-color:#333; color:white; font-size:0.8rem;" onclick="location.reload()">NEXT JOB</button>
    </div>

    <div id="lose-screen"><h1>BID REJECTED</h1><button class="img-btn" style="height:60px; width:150px;" onclick="location.reload()">RE-TRY</button></div>

    <div id="left-tap" class="tap-zone" style="left:0;"></div>
    <div id="right-tap" class="tap-zone" style="right:0;"></div>

    <canvas id="gameCanvas" width="800" height="450"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const GROUND_Y = 380; 

    // Audio Setup
    const sounds = {
        jump: new Audio('jump.wav'),
        duck: new Audio('duck.wav'),
        success: new Audio('success.wav')
    };

    function playSfx(name) {
        sounds[name].currentTime = 0;
        sounds[name].play().catch(() => {}); 
    }

    let state = { active: false, job: 'hvac', challenges: 0, speed: 7.5, houseX: 1200 };
    const assets = {};
    const sources = {
        bg: 'game_bg.jpg', hvac_normal: 'hvac_normal.png', roofer_normal: 'roofer_normal.png',
        van: 'van.png', cone: 'obstacle_cone.png', crack: 'obstacle_crack.png',
        barricade: 'obstacle_barricade.png', lowbid: 'obstacle_lowbid.png',
        scam: 'scam_ad.png', house: 'menu_bg.jpg.jpg',
        logo_hvac: 'aQuality-logo.png', logo_roof: 'lyons-horz-logo.png'
    };

    Object.keys(sources).forEach(key => { assets[key] = new Image(); assets[key].src = sources[key]; });

    const player = { x: 80, y: GROUND_Y - 85, w: 85, h: 85, dy: 0, jump: 17, grav: 0.8, jumpsLeft: 2, isDucking: false };
    let obstacles = [];

    function initGame(job) {
        state.job = job; state.active = true;
        document.getElementById('menu').style.display = 'none';
        document.querySelectorAll('.tap-zone').forEach(z => z.style.display = 'block');
        spawnLoop(); gameLoop();
    }

    function spawnLoop() {
        if (!state.active || state.challenges >= 20) return;
        const types = ['van', 'cone', 'crack', 'barricade', 'lowbid', 'scam'];
        const type = types[Math.floor(Math.random() * types.length)];
        let w = 70, h = 70, y = GROUND_Y - 70;
        if(type === 'van') { w = 230; h = 135; y = GROUND_Y - 135; }
        if(type === 'scam') { w = 200; h = 85; y = GROUND_Y - 115; }
        obstacles.push({ x: 850, y: y, w: w, h: h, type: type });
        state.challenges++;
        setTimeout(spawnLoop, 1400 + Math.random() * 800);
    }

    function gameLoop() {
        if (!state.active) return;
        update(); draw();
        requestAnimationFrame(gameLoop);
    }

    function update() {
        player.dy += player.grav;
        player.y += player.dy;
        let floor = player.isDucking ? GROUND_Y - 40 : GROUND_Y - 85;
        if (player.y > floor) { player.y = floor; player.dy = 0; player.jumpsLeft = 2; }

        obstacles.forEach((obs) => {
            obs.x -= state.speed;
            if (checkCollision(player, obs)) {
                state.active = false; document.getElementById('lose-screen').style.display = 'flex';
            }
        });

        if (state.challenges >= 20) {
            state.houseX -= state.speed;
            if (player.x + player.w > state.houseX + 150) finishJob();
        }
    }

    function finishJob() {
        state.active = false;
        playSfx('success');
        const logo = document.getElementById('win-brand-logo');
        const quote = document.getElementById('customer-quote');
        if(state.job === 'hvac') {
            logo.src = 'aQuality-logo.png';
            quote.innerHTML = "“A Quality HVAC was fast and professional. Our house is cool again!”";
        } else {
            logo.src = 'lyons-horz-logo.png';
            quote.innerHTML = "“Lyons Roofing did an amazing job. No more leaks! Best in town.”";
        }
        document.getElementById('win-screen').style.display = 'flex';
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 450);
        if(assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, 800, 450);
        const hudLogo = state.job === 'hvac' ? assets.logo_hvac : assets.logo_roof;
        if(hudLogo?.complete) ctx.drawImage(hudLogo, 20, 395, 65, 35);
        if (state.challenges >= 20 && assets.house.complete) ctx.drawImage(assets.house, state.houseX, 50, 400, 400);

        let charKey = `${state.job}_normal`;
        let drawH = player.isDucking ? 40 : 85;
        if(assets[charKey]?.complete) ctx.drawImage(assets[charKey], player.x, player.y, player.w, drawH);
        obstacles.forEach(o => { if(assets[o.type]?.complete) ctx.drawImage(assets[o.type], o.x, o.y, o.w, o.h); });
    }

    function checkCollision(p, o) {
        let pH = p.isDucking ? 40 : 85;
        return p.x + 25 < o.x + o.w && p.x + p.w - 25 > o.x && p.y + 20 < o.y + o.h && p.y + pH - 20 > o.y;
    }

    // Input Logic with WAV sounds
    window.addEventListener('keydown', (e) => {
        if ((e.code === 'Space' || e.code === 'ArrowUp') && player.jumpsLeft > 0) { 
            player.dy = -player.jump; player.jumpsLeft--; 
            playSfx('jump');
        }
        if (e.code === 'ArrowDown' && !player.isDucking) {
            player.isDucking = true;
            playSfx('duck');
        }
    });
    window.addEventListener('keyup', (e) => { if (e.code === 'ArrowDown') player.isDucking = false; });
    
    document.getElementById('left-tap').addEventListener('touchstart', (e) => { 
        e.preventDefault(); 
        if (player.jumpsLeft > 0) { 
            player.dy = -player.jump; player.jumpsLeft--; 
            playSfx('jump');
        } 
    });
    document.getElementById('right-tap').addEventListener('touchstart', (e) => { 
        e.preventDefault(); 
        player.isDucking = true; 
        playSfx('duck');
    });
    document.getElementById('right-tap').addEventListener('touchend', (e) => { e.preventDefault(); player.isDucking = false; });
</script>
</body>
</html>
