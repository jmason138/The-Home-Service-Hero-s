<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Home Service Hero</title>
  <style>
    :root{
      --bg:#111;
      --panel:#1b1b1b;
      --accent:#ffcc00;
      --good:#61BB46;
      --bad:#e84b3c;
      --cyan:#10a7ff;
      --white:#fff;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 50% 30%, #2b2b2b 0%, #111 55%, #0b0b0b 100%);
      color:var(--white);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:18px;
    }

    #shell{
      width:min(980px, 100%);
    }

    #header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }

    #title{
      margin:0;
      text-transform:uppercase;
      letter-spacing:2px;
      font-weight:900;
      font-size:clamp(22px, 3.2vw, 44px);
      color:var(--accent);
      text-shadow: 0 3px 0 #000, 0 0 14px rgba(255,204,0,.25);
    }

    #tagline{
      margin:6px 0 0;
      color:#d6d6d6;
      font-size:12px;
      opacity:.85;
    }

    #panel{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:2px solid #000;
      background:linear-gradient(180deg, #2a2a2a, #151515);
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.3px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      user-select:none;
      touch-action:manipulation;
    }
    .btn:hover{ transform:translateY(-1px); }
    .btn:active{ transform:translateY(1px); }

    .btn.primary{
      background:linear-gradient(180deg, #ffd54a, #ffb800);
      color:#1a1a1a;
      border-color:#000;
    }

    .btn.bad{
      background:linear-gradient(180deg, #ff6a5d, #e84b3c);
    }

    .btn.good{
      background:linear-gradient(180deg, #7bd85a, #61BB46);
      color:#0a0a0a;
    }

    #gameWrap{
      position:relative;
      width:100%;
      max-width:980px;
      aspect-ratio: 16 / 9;
      border-radius:18px;
      border:3px solid rgba(255,204,0,.9);
      background:linear-gradient(180deg, rgba(255,204,0,.08), rgba(0,0,0,.12));
      overflow:hidden;
      box-shadow:0 26px 80px rgba(0,0,0,.55);
    }

    canvas{
      width:100%;
      height:100%;
      display:block;
      image-rendering: pixelated;
      background:linear-gradient(180deg, #141414, #0c0c0c);
    }

    #hud{
      position:absolute;
      inset:0;
      pointer-events:none;
      padding:12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      font-weight:900;
      text-shadow: 0 2px 0 #000;
    }

    .hudBox{
      background:rgba(0,0,0,.38);
      border:2px solid rgba(255,204,0,.55);
      border-radius:14px;
      padding:10px 12px;
      display:flex;
      gap:12px;
      align-items:center;
      backdrop-filter: blur(4px);
    }

    .hudItem{
      display:flex;
      gap:8px;
      align-items:center;
      font-size:12px;
      letter-spacing:.4px;
      text-transform:uppercase;
      opacity:.95;
    }
    .dot{
      width:10px; height:10px; border-radius:3px;
      background:var(--accent);
      box-shadow:0 0 18px rgba(255,204,0,.45);
    }
    .dot.cyan{ background:var(--cyan); box-shadow:0 0 18px rgba(16,167,255,.35); }
    .dot.good{ background:var(--good); box-shadow:0 0 18px rgba(97,187,70,.35); }
    .dot.bad{ background:var(--bad); box-shadow:0 0 18px rgba(232,75,60,.35); }

    #help{
      position:absolute;
      left:12px;
      bottom:12px;
      max-width: 360px;
      background:rgba(0,0,0,.45);
      border:2px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px 12px;
      color:#e9e9e9;
      font-size:12px;
      line-height:1.35;
      backdrop-filter: blur(4px);
    }
    #help b{ color:var(--accent); }

    #overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      padding:16px;
    }

    .card{
      width:min(560px, 96%);
      border-radius:18px;
      border:3px solid rgba(255,204,0,.8);
      background:linear-gradient(180deg, rgba(35,35,35,.9), rgba(10,10,10,.92));
      box-shadow:0 30px 90px rgba(0,0,0,.6);
      padding:18px;
      text-align:center;
    }
    .card h2{
      margin:4px 0 8px;
      font-size:clamp(22px, 3vw, 34px);
      color:var(--accent);
      text-transform:uppercase;
      letter-spacing:1px;
      text-shadow: 0 3px 0 #000;
    }
    .card p{
      margin:0 0 14px;
      color:#d9d9d9;
      font-size:14px;
      line-height:1.35;
      opacity:.95;
    }
    .row{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:2px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.35);
      color:#f0f0f0;
      font-weight:800;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.4px;
    }
    .k{
      width:22px;height:22px;border-radius:8px;
      display:grid; place-items:center;
      background:rgba(255,204,0,.2);
      border:2px solid rgba(255,204,0,.6);
      color:var(--accent);
      text-shadow:none;
      font-weight:900;
    }

    @media (max-width: 640px){
      #help{ display:none; }
      #panel{ justify-content:flex-start; }
    }
  </style>
</head>
<body>
  <div id="shell">
    <div id="header">
      <div>
        <h1 id="title">Home Service Hero</h1>
        <div id="tagline">Dodge ‚ÄúLow Bid Traps‚Äù + ‚ÄúFake Pro‚Äù vans. Double-jump and duck. Collect referral stars. Protect your reputation.</div>
      </div>

      <div id="panel">
        <button id="btnStart" class="btn primary">Start</button>
        <button id="btnPause" class="btn">Pause</button>
        <button id="btnReset" class="btn bad">Reset</button>
      </div>
    </div>

    <div id="gameWrap">
      <canvas id="c"></canvas>

      <div id="hud">
        <div class="hudBox">
          <div class="hudItem"><span class="dot good"></span> Score: <span id="score">0</span></div>
          <div class="hudItem"><span class="dot cyan"></span> Stars: <span id="stars">0</span></div>
          <div class="hudItem"><span class="dot bad"></span> Reputation: <span id="rep">100</span>%</div>
        </div>
        <div class="hudBox">
          <div class="hudItem"><span class="dot"></span> Speed: <span id="spd">1.0x</span></div>
        </div>
      </div>

      <div id="help">
        <div><b>Controls</b></div>
        <div>Jump: <b>Space</b> / <b>W</b> / <b>Up</b> (double-jump enabled)</div>
        <div>Duck: <b>S</b> / <b>Down</b></div>
        <div>Mobile: tap right side to jump, hold left side to duck</div>
      </div>

      <div id="overlay">
        <div class="card">
          <h2 id="ovTitle">Ready?</h2>
          <p id="ovText">
            You‚Äôre the Quality Pro. Keep your reputation clean by dodging traps and fake vans,
            and grab stars for referrals. The pace ramps up.
          </p>
          <div class="row">
            <div class="pill"><span class="k">‚ê£</span> Jump / Double</div>
            <div class="pill"><span class="k">‚Üì</span> Duck</div>
            <div class="pill"><span class="k">R</span> Restart</div>
          </div>
          <div class="row">
            <button id="ovPlay" class="btn primary">Play</button>
            <button id="ovClose" class="btn">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- Canvas setup ----------
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  function resize() {
    const rect = canvas.getBoundingClientRect();
    const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    canvas.width  = Math.floor(rect.width  * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  }
  window.addEventListener("resize", resize);

  // ---------- UI ----------
  const elScore = document.getElementById("score");
  const elStars = document.getElementById("stars");
  const elRep   = document.getElementById("rep");
  const elSpd   = document.getElementById("spd");

  const btnStart = document.getElementById("btnStart");
  const btnPause = document.getElementById("btnPause");
  const btnReset = document.getElementById("btnReset");

  const overlay  = document.getElementById("overlay");
  const ovTitle  = document.getElementById("ovTitle");
  const ovText   = document.getElementById("ovText");
  const ovPlay   = document.getElementById("ovPlay");
  const ovClose  = document.getElementById("ovClose");

  // ---------- Game constants ----------
  const GROUND_H = 80;
  const GRAVITY  = 2400; // px/s^2
  const JUMP_V1  = 860;  // px/s
  const JUMP_V2  = 780;  // px/s
  const DUCK_SCALE = 0.62;

  const COLORS = {
    sky1: "#0f0f0f",
    sky2: "#171717",
    grid: "rgba(255,255,255,.06)",
    accent: "#ffcc00",
    good: "#61BB46",
    bad: "#e84b3c",
    cyan: "#10a7ff",
    white: "#ffffff",
    black: "#000000"
  };

  // ---------- Helpers ----------
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const rand  = (a, b) => a + Math.random() * (b - a);

  function aabb(a, b){
    return a.x < b.x + b.w && a.x + a.w > b.x &&
           a.y < b.y + b.h && a.y + a.h > b.y;
  }

  // ---------- State ----------
  let running = false;
  let paused  = false;
  let lastT   = 0;

  let score = 0;
  let stars = 0;
  let rep   = 100;

  let speedMul = 1.0;
  let baseSpeed = 360; // px/s

  const player = {
    x: 120,
    y: 0,
    w: 44,
    h: 64,
    vy: 0,
    onGround: true,
    canDouble: true,
    ducking: false,
  };

  const hazards = [];
  const pickups = [];

  let nextHazardIn = 0;
  let nextPickupIn = 0;

  // ---------- Spawning ----------
  function spawnHazard(){
    const H = canvas.getBoundingClientRect().height;
    const W = canvas.getBoundingClientRect().width;
    const groundY = H - GROUND_H;

    const kind = Math.random() < 0.55 ? "trap" : "van";

    if (kind === "trap"){
      // Low Bid Trap: ground obstacle
      hazards.push({
        kind,
        x: W + 30,
        y: groundY - 34,
        w: rand(34, 54),
        h: rand(30, 38),
        hit: false,
      });
    } else {
      // Fake Pro Van: sometimes high enough to require duck
      const tall = Math.random() < 0.55;
      hazards.push({
        kind,
        x: W + 30,
        y: tall ? groundY - 110 : groundY - 78,
        w: 96,
        h: tall ? 70 : 48,
        hit: false,
        tall
      });
    }
  }

  function spawnPickup(){
    const H = canvas.getBoundingClientRect().height;
    const W = canvas.getBoundingClientRect().width;
    const groundY = H - GROUND_H;

    // star floats somewhere between jump arc and ground
    const py = rand(groundY - 170, groundY - 90);
    pickups.push({
      x: W + 30,
      y: py,
      w: 26,
      h: 26,
      taken: false
    });
  }

  // ---------- Rendering ----------
  function drawBackground(){
    const W = canvas.getBoundingClientRect().width;
    const H = canvas.getBoundingClientRect().height;

    // sky
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, COLORS.sky2);
    g.addColorStop(1, COLORS.sky1);
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // subtle grid
    ctx.strokeStyle = COLORS.grid;
    ctx.lineWidth = 1;
    for (let x=0; x<W; x+=40){
      ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke();
    }
    for (let y=0; y<H; y+=40){
      ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke();
    }

    // ground
    ctx.fillStyle = "rgba(255,204,0,.10)";
    ctx.fillRect(0, H - GROUND_H, W, GROUND_H);

    // ground stripes
    ctx.strokeStyle = "rgba(255,204,0,.22)";
    for (let x=0; x<W; x+=26){
      ctx.beginPath();
      ctx.moveTo(x, H - GROUND_H);
      ctx.lineTo(x+14, H);
      ctx.stroke();
    }
  }

  function drawPlayer(){
    const H = canvas.getBoundingClientRect().height;
    const groundY = H - GROUND_H;

    const px = player.x;
    const py = player.y;

    // shadow
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.beginPath();
    ctx.ellipse(px + player.w/2, groundY + 8, player.w/2, 10, 0, 0, Math.PI*2);
    ctx.fill();

    // hero body (pixel-ish)
    ctx.save();
    ctx.translate(px, py);

    // duck changes height
    const h = player.h;
    const w = player.w;

    // outline
    ctx.fillStyle = "rgba(0,0,0,.85)";
    ctx.fillRect(-2, -2, w+4, h+4);

    // suit
    ctx.fillStyle = "rgba(255,255,255,.95)";
    ctx.fillRect(0, 0, w, h);

    // shirt stripe
    ctx.fillStyle = "rgba(16,167,255,.95)";
    ctx.fillRect(6, 10, w-12, 10);

    // belt
    ctx.fillStyle = "rgba(0,0,0,.75)";
    ctx.fillRect(0, h-18, w, 6);

    // logo badge
    ctx.fillStyle = "rgba(255,204,0,.95)";
    ctx.fillRect(w-16, 18, 10, 10);

    // visor/eye
    ctx.fillStyle = "rgba(0,0,0,.85)";
    ctx.fillRect(10, 26, 18, 8);

    // boot
    ctx.fillStyle = "rgba(97,187,70,.95)";
    ctx.fillRect(6, h-8, 14, 8);
    ctx.fillRect(w-20, h-8, 14, 8);

    ctx.restore();
  }

  function drawHazards(){
    const W = canvas.getBoundingClientRect().width;
    const H = canvas.getBoundingClientRect().height;
    const groundY = H - GROUND_H;

    for (const z of hazards){
      if (z.kind === "trap"){
        // "Low Bid Trap" box
        ctx.fillStyle = "rgba(0,0,0,.85)";
        ctx.fillRect(z.x-2, z.y-2, z.w+4, z.h+4);

        ctx.fillStyle = "rgba(232,75,60,.92)";
        ctx.fillRect(z.x, z.y, z.w, z.h);

        ctx.fillStyle = "rgba(0,0,0,.45)";
        ctx.fillRect(z.x, z.y + z.h*0.55, z.w, z.h*0.45);

        ctx.fillStyle = "rgba(255,255,255,.95)";
        ctx.font = "900 12px system-ui";
        ctx.fillText("LOW", z.x+6, z.y+16);
        ctx.fillText("BID", z.x+6, z.y+30);

      } else {
        // "Fake Pro" van
        ctx.fillStyle = "rgba(0,0,0,.85)";
        ctx.fillRect(z.x-2, z.y-2, z.w+4, z.h+4);

        ctx.fillStyle = "rgba(255,204,0,.92)";
        ctx.fillRect(z.x, z.y, z.w, z.h);

        // windows
        ctx.fillStyle = "rgba(0,0,0,.65)";
        ctx.fillRect(z.x+12, z.y+10, 26, 18);
        ctx.fillRect(z.x+44, z.y+10, 26, 18);

        // wheels
        ctx.fillStyle = "rgba(0,0,0,.9)";
        ctx.beginPath(); ctx.arc(z.x+22, z.y+z.h+6, 10, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(z.x+74, z.y+z.h+6, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "rgba(255,255,255,.85)";
        ctx.beginPath(); ctx.arc(z.x+22, z.y+z.h+6, 4, 0, Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.arc(z.x+74, z.y+z.h+6, 4, 0, Math.PI*2); ctx.fill();

        // label
        ctx.fillStyle = "rgba(0,0,0,.75)";
        ctx.fillRect(z.x+10, z.y+z.h-24, z.w-20, 16);
        ctx.fillStyle = "rgba(255,255,255,.95)";
        ctx.font = "900 12px system-ui";
        ctx.fillText("FAKE PRO", z.x+18, z.y+z.h-12);
      }
    }
  }

  function drawPickups(){
    for (const p of pickups){
      if (p.taken) continue;

      // star glow
      ctx.fillStyle = "rgba(255,204,0,.20)";
      ctx.beginPath();
      ctx.arc(p.x+p.w/2, p.y+p.h/2, 18, 0, Math.PI*2);
      ctx.fill();

      // star (simple 5-point)
      const cx = p.x + p.w/2;
      const cy = p.y + p.h/2;

      ctx.save();
      ctx.translate(cx, cy);
      ctx.fillStyle = "rgba(0,0,0,.85)";
      starPath(0,0, 12, 5, 0.5); ctx.fill();

      ctx.fillStyle = "rgba(255,204,0,.95)";
      starPath(0,0, 10, 5, 0.5); ctx.fill();
      ctx.restore();
    }

    function starPath(x,y,r,points,inner){
      ctx.beginPath();
      let rot = -Math.PI/2;
      const step = Math.PI/points;
      for (let i=0;i<points*2;i++){
        const rr = (i%2===0) ? r : r*inner;
        ctx.lineTo(x + Math.cos(rot)*rr, y + Math.sin(rot)*rr);
        rot += step;
      }
      ctx.closePath();
    }
  }

  function drawScanlines(){
    const W = canvas.getBoundingClientRect().width;
    const H = canvas.getBoundingClientRect().height;
    ctx.fillStyle = "rgba(0,0,0,.10)";
    for (let y=0;y<H;y+=3){
      ctx.fillRect(0,y,W,1);
    }
  }

  // ---------- Game loop ----------
  function reset(){
    score = 0; stars = 0; rep = 100;
    speedMul = 1.0;
    hazards.length = 0;
    pickups.length = 0;
    nextHazardIn = 0;
    nextPickupIn = 0;

    const H = canvas.getBoundingClientRect().height;
    const groundY = H - GROUND_H;
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
    player.canDouble = true;
    player.ducking = false;

    updateHud();
    showOverlay("Ready?", "You‚Äôre the Quality Pro. Dodge traps and fake vans, collect referral stars, and keep your reputation at 100%.");
  }

  function updateHud(){
    elScore.textContent = String(Math.floor(score));
    elStars.textContent = String(stars);
    elRep.textContent = String(Math.floor(rep));
    elSpd.textContent = `${speedMul.toFixed(1)}x`;
  }

  function showOverlay(title, text){
    ovTitle.textContent = title;
    ovText.textContent = text;
    overlay.style.display = "flex";
  }

  function hideOverlay(){
    overlay.style.display = "none";
  }

  function gameOver(reason){
    running = false;
    paused = false;
    btnPause.textContent = "Pause";
    showOverlay("Game Over", reason + " Press Play or hit R to run it back.");
  }

  function tick(t){
    if (!running){ lastT = t; requestAnimationFrame(tick); return; }
    if (paused){ lastT = t; requestAnimationFrame(tick); return; }

    const W = canvas.getBoundingClientRect().width;
    const H = canvas.getBoundingClientRect().height;
    const groundY = H - GROUND_H;

    const dt = Math.min(0.033, (t - lastT)/1000 || 0);
    lastT = t;

    // ramp speed
    score += 20 * dt * speedMul;
    speedMul = 1.0 + Math.min(2.2, score / 650); // tops around 3.2x
    const speed = baseSpeed * speedMul;

    // spawn timers
    nextHazardIn -= dt;
    nextPickupIn -= dt;

    if (nextHazardIn <= 0){
      spawnHazard();
      nextHazardIn = rand(0.75, 1.25) / Math.sqrt(speedMul); // faster = more frequent
    }
    if (nextPickupIn <= 0){
      spawnPickup();
      nextPickupIn = rand(1.1, 1.8);
    }

    // physics player
    const prevH = player.h;
    if (player.ducking && player.onGround){
      player.h = 64 * DUCK_SCALE;
    } else {
      player.h = 64;
    }
    // keep feet planted when changing height
    if (player.onGround){
      player.y = groundY - player.h;
    } else if (player.h !== prevH){
      // adjust center a bit mid-air
      player.y += (prevH - player.h) * 0.5;
    }

    player.vy += GRAVITY * dt;
    player.y += player.vy * dt;

    if (player.y >= groundY - player.h){
      player.y = groundY - player.h;
      player.vy = 0;
      if (!player.onGround){
        player.onGround = true;
        player.canDouble = true;
      }
    } else {
      player.onGround = false;
    }

    // move hazards/pickups
    for (const z of hazards){
      z.x -= speed * dt;
    }
    for (const p of pickups){
      p.x -= speed * dt;
    }

    // collisions
    const pBox = { x: player.x, y: player.y, w: player.w, h: player.h };

    for (const z of hazards){
      if (z.hit) continue;
      const zBox = { x: z.x, y: z.y, w: z.w, h: z.h + (z.kind==="van" ? 14 : 0) };

      if (aabb(pBox, zBox)){
        z.hit = true;

        if (z.kind === "trap"){
          rep -= 18;
          if (rep <= 0){
            rep = 0;
            updateHud();
            gameOver("You hit a Low Bid Trap and your reputation cratered. ‚ò†Ô∏è");
            break;
          }
        } else {
          rep -= z.tall ? 22 : 16;
          if (rep <= 0){
            rep = 0;
            updateHud();
            gameOver("You got sideswiped by a Fake Pro van and your reviews went feral. üßü");
            break;
          }
        }
      }
    }

    for (const p of pickups){
      if (p.taken) continue;
      const b = { x:p.x, y:p.y, w:p.w, h:p.h };
      if (aabb(pBox, b)){
        p.taken = true;
        stars += 1;
        // small rep boost cap 100
        rep = clamp(rep + 3, 0, 100);
      }
    }

    // cleanup offscreen
    while (hazards.length && hazards[0].x < -200) hazards.shift();
    while (pickups.length && pickups[0].x < -200) pickups.shift();

    // draw
    drawBackground();

    // ‚Äúdistance line‚Äù
    ctx.fillStyle = "rgba(255,255,255,.10)";
    ctx.fillRect(0, groundY, W, 2);

    drawPickups();
    drawHazards();
    drawPlayer();

    // danger vignette as rep falls
    if (rep < 65){
      const alpha = clamp((65 - rep) / 65, 0, 0.55);
      ctx.fillStyle = `rgba(232,75,60,${alpha})`;
      ctx.fillRect(0,0,W,H);
    }

    drawScanlines();

    updateHud();
    requestAnimationFrame(tick);
  }

  // ---------- Controls ----------
  function jump(){
    if (!running) return;
    if (paused) return;

    if (player.onGround){
      player.vy = -JUMP_V1;
      player.onGround = false;
      player.canDouble = true;
    } else if (player.canDouble){
      player.vy = -JUMP_V2;
      player.canDouble = false;
    }
  }

  function setDuck(on){
    player.ducking = on;
  }

  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();

    if (k === " " || k === "arrowup" || k === "w"){
      e.preventDefault();
      hideOverlay();
      if (!running) start();
      jump();
    }
    if (k === "arrowdown" || k === "s"){
      e.preventDefault();
      setDuck(true);
    }
    if (k === "p"){
      togglePause();
    }
    if (k === "r"){
      reset();
      start();
      hideOverlay();
    }
  });

  window.addEventListener("keyup", (e) => {
    const k = e.key.toLowerCase();
    if (k === "arrowdown" || k === "s"){
      setDuck(false);
    }
  });

  // Mobile controls: left half = duck (hold), right half = jump (tap)
  canvas.addEventListener("pointerdown", (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    hideOverlay();
    if (!running) start();

    if (x < rect.width * 0.45){
      setDuck(true);
    } else {
      jump();
    }
  });
  canvas.addEventListener("pointerup", () => setDuck(false));
  canvas.addEventListener("pointercancel", () => setDuck(false));

  // ---------- Buttons ----------
  function start(){
    running = true;
    paused = false;
    btnPause.textContent = "Pause";
  }

  function togglePause(){
    if (!running) return;
    paused = !paused;
    btnPause.textContent = paused ? "Resume" : "Pause";
  }

  btnStart.addEventListener("click", () => {
    hideOverlay();
    if (!running) start();
  });

  btnPause.addEventListener("click", () => togglePause());

  btnReset.addEventListener("click", () => {
    reset();
    start();
    hideOverlay();
  });

  ovPlay.addEventListener("click", () => {
    hideOverlay();
    if (!running) start();
  });

  ovClose.addEventListener("click", () => hideOverlay());

  // ---------- Boot ----------
  resize();
  reset();
  requestAnimationFrame(tick);
})();
</script>

</body>
</html>
