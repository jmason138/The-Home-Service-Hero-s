<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE HOME SERVICE HERO: PRO</title>
    <style>
        :root { --gold: #ffcc00; --cyan: #00f2ff; }
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Arial Black', sans-serif; overflow: hidden; }
        #game-viewport { position: relative; width: 800px; height: 600px; border: 4px solid #333; background: #111; box-shadow: 0 0 50px #000; }
        #menu { position: absolute; inset: 0; background: radial-gradient(circle, #222, #000); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        h1 { font-size: 4rem; margin: 0; color: var(--gold); text-shadow: 3px 3px 0 #000; }
        .subtitle { color: var(--cyan); letter-spacing: 5px; margin-bottom: 30px; text-transform: uppercase; }
        .btn-group { display: none; gap: 20px; } /* Hidden until loaded */
        #loader-text { color: var(--gold); font-size: 1.2rem; margin-bottom: 20px; }
        button { padding: 20px 40px; font-size: 1.2rem; font-weight: 900; cursor: pointer; border: 3px solid var(--gold); background: transparent; color: var(--gold); text-transform: uppercase; transition: 0.2s; }
        button:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px var(--gold); }
    </style>
</head>
<body>

<div id="game-viewport">
    <div id="menu">
        <h1>HOME SERVICE HERO</h1>
        <div class="subtitle">Trades At War</div>
        <div id="loader-text">PREPARING TRADES...</div>
        <div class="btn-group" id="controls">
            <button onclick="initGame('hvac')">HVAC TECH</button>
            <button onclick="initGame('roofer')">ROOFER</button>
        </div>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const menu = document.getElementById('menu');
    const loader = document.getElementById('loader-text');
    const controls = document.getElementById('controls');

    let state = { active: false, score: 0, speed: 8, isGold: false, goldTimer: 0, job: 'hvac' };

    // --- PRO IMAGE LOADING SYSTEM ---
    const assets = {};
    const sources = {
        bg: './game_bg.jpg',
        hvac_normal: './hvac_normal.png', hvac_gold: './hvac_gold.png',
        roofer_normal: './roofer_normal.png', roofer_gold: './roofer_gold.png',
        van: './van.png', cone: './obstacle_cone.png', crack: './obstacle_crack.png',
        barricade: './obstacle_barricade.png', lowbid: './obstacle_lowbid.png',
        energy: './energy_drink.png'
    };

    let loadedCount = 0;
    const totalAssets = Object.keys(sources).length;

    Object.keys(sources).forEach(key => {
        assets[key] = new Image();
        assets[key].src = sources[key];
        assets[key].onload = () => {
            loadedCount++;
            if (loadedCount >= totalAssets) {
                loader.style.display = 'none';
                controls.style.display = 'flex';
            }
        };
        assets[key].onerror = () => {
            console.error("Failed to load: " + key);
            loadedCount++; // Still increment to unblock the game
        };
    });

    const player = { x: 620, y: 435, w: 100, h: 100, dy: 0, jump: 18, grav: 0.85, grounded: false };
    let obstacles = [];
    let items = [];

    function initGame(job) {
        state.job = job; state.active = true;
        menu.style.display = 'none';
        spawnLoop();
        gameLoop();
    }

    function spawnLoop() {
        if (!state.active) return;
        const types = ['van', 'cone', 'crack', 'barricade', 'lowbid'];
        const type = types[Math.floor(Math.random() * types.length)];
        let w = 80, h = 80;
        if(type === 'van') { w = 180; h = 110; }
        obstacles.push({ x: -200, y: 535 - h, w, h, type });
        setTimeout(spawnLoop, 2000);
    }

    function gameLoop() {
        if (!state.active) return;
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    function update() {
        player.dy += player.grav;
        player.y += player.dy;
        if (player.y > 435) { player.y = 435; player.dy = 0; player.grounded = true; }

        obstacles.forEach((obs, i) => {
            obs.x += state.speed;
            if (checkCollision(player, obs)) location.reload();
            if (obs.x > 850) obstacles.splice(i, 1);
        });
        state.score += 0.1;
    }

    function checkCollision(p, o) {
        return p.x < o.x + o.w - 20 && p.x + p.w > o.x + 20 && p.y < o.y + o.h - 10 && p.y + p.h > o.y + 10;
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 600);
        // Draw Background
        if(assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, 800, 600);
        
        // Draw Player
        const key = `${state.job}_normal`;
        if(assets[key].complete) ctx.drawImage(assets[key], player.x, player.y, player.w, player.h);

        // Draw Obstacles
        obstacles.forEach(o => {
            if(assets[o.type].complete) ctx.drawImage(assets[o.type], o.x, o.y, o.w, o.h);
        });

        ctx.fillStyle = "white";
        ctx.font = "bold 24px Arial";
        ctx.fillText(`SCORE: ${Math.floor(state.score)}`, 20, 40);
    }

    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && player.grounded) {
            player.dy = -player.jump; player.grounded = false;
        }
    });
</script>
</body>
</html>
