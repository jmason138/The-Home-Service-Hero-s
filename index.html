<script>
    // ... (Keep the rest of your top code the same, just update these specific parts)

    function spawnLoop() {
        if (!state.active || state.challenges >= 20) return;
        
        const isHigh = Math.random() > 0.5;
        if(isHigh) {
            // SCAM AD - Lowered to height 345 so it hits the Pro's head
            // Increased height to 120 to make it a bigger threat
            obstacles.push({ x: 850, y: 345, w: 180, h: 120, type: 'scam' });
        } else {
            // LOW COMPETITOR (Jump over)
            obstacles.push({ x: 850, y: 450, w: 140, h: 90, type: 'van' });
        }

        state.challenges++;
        document.getElementById('count').innerText = state.challenges;
        setTimeout(spawnLoop, 1500 + Math.random() * 800);
    }

    function draw() {
        ctx.clearRect(0, 0, 800, 600);
        if(assets.bg.complete) ctx.drawImage(assets.bg, 0, 0, 800, 600);
        if (state.challenges >= 20 && assets.house.complete) ctx.drawImage(assets.house, state.houseX, 200, 350, 350);

        const pImg = state.job === 'hvac' ? assets.hvac : assets.roofer;
        
        // DUCKING LOGIC: Shrink the Pro's height by 60% when ducking
        let drawH = player.h;
        let drawY = player.y;

        if(player.isDucking && player.grounded) {
            drawH = player.h * 0.4; // Pro is now 40% height
            drawY = player.y + (player.h * 0.6); // Moves the image down to the floor
        }

        if(pImg.complete) ctx.drawImage(pImg, player.x, drawY, player.w, drawH);

        obstacles.forEach(o => {
            if(assets[o.type].complete) ctx.drawImage(assets[o.type], o.x, o.y, o.w, o.h);
        });
    }

    function checkCollision(p, o) {
        // Tight collision detection for the Scam Ad
        let pH = p.isDucking && p.grounded ? p.h * 0.4 : p.h;
        let pY = p.isDucking && p.grounded ? p.y + (p.h * 0.6) : p.y;
        
        const b = 20; // Hitbox padding
        return p.x + b < o.x + o.w && 
               p.x + p.w - b > o.x && 
               pY + b < o.y + o.h && 
               pY + pH - b > o.y;
    }
    
    // ... (Keep the rest of your keyboard listeners)
</script>
